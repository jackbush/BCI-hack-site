"use strict";var ApplicationConfiguration=function(){var applicationModuleName="bci-site",applicationModuleVendorDependencies=["ngResource","ngTouch","ui.router","ui.bootstrap","ui.utils","btford.socket-io","angular-p5"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("game"),ApplicationConfiguration.registerModule("users"),ApplicationConfiguration.registerModule("visualisation"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"}).state("introduction",{url:"/introduction",templateUrl:"modules/core/views/introduction.client.view.html"}).state("about",{url:"/about",templateUrl:"modules/core/views/about.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","$window","socketFactory",function($scope){$scope.check=!1,$scope.toggleEeg=function(){$scope.check=$scope.check===!1?!0:!1};var socket=io.connect("http://localhost:9876");socket.on("eeg",function(data){$scope.$apply(function(){$scope.eegBlink=data?data.blinkStrength:"",$scope.eegAttention=data?data.eSense.attention:"",$scope.eegMeditation=data?data.eSense.meditation:"",$scope.eegDelta=data?data.eegPower.delta:"",$scope.eegTheta=data?data.eegPower.theta:"",$scope.eegLowAlpha=data?data.eegPower.lowAlpha:"",$scope.eegHighAlpha=data?data.eegPower.highAlpha:"",$scope.eegLowBeta=data?data.eegPower.lowBeta:"",$scope.eegHighBeta=data?data.eegPower.highBeta:"",$scope.eegLowGamma=data?data.eegPower.lowGamma:"",$scope.eegHighGamma=data?data.eegPower.highGamma:"",$scope.eegSignal=100-data.poorSignalLevel/2})})}]),angular.module("core").controller("HomeController",["$scope","socketFactory",function($scope){$scope.selectedIntroduction="1",$scope.introductions=[{num:"1",title:"Welcome",body:"Below is a brief connection guide and two simple exercises to introduce you to the technology. Once you feel comfortable, use the navigation links above to click through to more complex games and visualisations. Using the full site requires an EEG headset."},{num:"2",title:"Connecting",body:"To get started, plug in your headset and click the CONNECTION area in the top right corner. As soon as a link is established, streaming data will appear. This panel is available throughout the site."},{num:"3",title:"Focus",body:"Bring the circles together by focussing on them. See if you can get them to overlap perfectly, and how long you can hold it for."},{num:"4",title:"Meditation",body:"Calm your mind to slow the oscillation of the outlines. Breathe deeply and see if you can get them to stop entirely."}],$scope.selectIntroduction=function(introduction){$scope.selectedIntroduction=introduction}}]),angular.module("core").factory("introSketch",[function(){return function(p){try{var socket=io.connect("http://localhost:9876")}catch(e){var socket=io.connect()}p.colorMode(p.RGBA,255);var p5height=window.innerHeight,p5width=window.innerWidth;p.setup=function(){p.createCanvas(p5width,p5height),p.background(250,250,250,255)},socket.on("eeg",function(data){var attention=data.eSense?data.eSense.attention:attention;console.log(attention);var meditation=data.eSense?data.eSense.meditation:60;console.log(meditation);var d=.8*p5height,meditationRange=50-meditation/2;p.draw=function(){if(p.background(255,255,255,20),p.fill(61,216,235,3),p.stroke(12,35,64,30),p.ellipseMode(p.CENTER),attention)p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d,d),p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random()),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d,d),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random());else{var testAttR=15*Math.random();p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d,d),p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random()),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d,d),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random())}}})}}]),angular.module("core").service("Menus",[function(){}]),angular.module("game").config(["$stateProvider",function($stateProvider){$stateProvider.state("games",{url:"/games",templateUrl:"modules/game/views/games.client.view.html"}).state("overlap",{url:"/games/overlap",templateUrl:"modules/game/views/overlap.client.view.html"}).state("outline",{url:"/games/outline",templateUrl:"modules/game/views/outline.client.view.html"})}]),angular.module("game").controller("GamesController",["$scope","socketFactory",function($scope,socketFactory){$scope.games=[{title:"OVERLAP",path:"/#!/games/overlap"},{title:"OUTLINE",path:"/#!/games/outline"}],$scope.focusScore=0,$scope.meditationScore=0,socketFactory().on("eeg",function(data){$scope.eegBlink=data.blinkStrength,$scope.eegAttention=data.eSense.attention,$scope.focusScore=100===$scope.eegAttention?$scope.focusScore+1:0,$scope.eegMeditation=data.eSense.meditation,$scope.meditationScore=100===$scope.eegMeditation?$scope.meditationScore+1:0,$scope.eegSignal=100-data.poorSignalLevel/2})}]),angular.module("game").factory("outlineGame",[function(){return function(p){try{var socket=io.connect("http://localhost:9876")}catch(e){var socket=io.connect()}p.colorMode(p.RGBA,255);var p5height=window.innerHeight,p5width=window.innerWidth;p.setup=function(){p.createCanvas(p5width,p5height),p.background(250,250,250,255)},socket.on("eeg",function(data){var meditation=data.eSense?data.eSense.meditation:60,d=.8*p5height,meditationRange=50-meditation/2;p.draw=function(){p.background(255,255,255,20),p.fill(61,216,235,3),p.stroke(12,35,64,30),p.ellipseMode(p.CENTER),p.ellipse(p5width/2,p5height/2+25,d,d),p.ellipse(p5width/2,p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2,p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random())}})}}]),angular.module("game").factory("overlapGame",[function(){return function(p){try{var socket=io.connect("http://localhost:9876")}catch(e){var socket=io.connect()}p.colorMode(p.RGBA,255);var p5height=window.innerHeight,p5width=window.innerWidth;p.setup=function(){p.createCanvas(p5width,p5height),p.background(250,250,250,255)},socket.on("eeg",function(data){var attention=data.eSense?data.eSense.attention:50,d=.8*p5height;p.draw=function(){p.background(255,255,255,20),p.fill(61,216,235,3),p.noStroke(),p.ellipseMode(p.CENTER),p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d,d),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d,d)}})}}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]),angular.module("visualisation").config(["$stateProvider",function($stateProvider){$stateProvider.state("visualisations",{url:"/visualisations",templateUrl:"modules/visualisation/views/visualisation.client.view.html"}).state("circles",{url:"/visualisations/circles",templateUrl:"modules/visualisation/views/circles.client.view.html"}).state("waves",{url:"/visualisations/waves",templateUrl:"modules/visualisation/views/waves.client.view.html"})}]),angular.module("visualisation").controller("VisualisationController",["$scope","socketFactory",function($scope){$scope.visualisations=[{title:"CIRCLES",path:"/#!/visualisations/circles"},{title:"WAVES",path:"/#!/visualisations/waves"}]}]),angular.module("visualisation").factory("circleVisualisation",["p5",function(){return function(p){try{var socket=io.connect("http://localhost:9876")}catch(e){var socket=io.connect()}p.colorMode(p.RGBA,255);var p5height=window.innerHeight,p5width=window.innerWidth;p.setup=function(){p.createCanvas(p5width,p5height),p.background(250,250,250,255)},socket.on("eeg",function(data){var attention=data.eSense?data.eSense.attention:attention,meditation=data.eSense?data.eSense.meditation:60,d=.8*p5height,meditationRange=50-meditation/2;p.draw=function(){if(p.background(255,255,255,20),p.fill(61,216,235,3),p.stroke(12,35,64,30),p.ellipseMode(p.CENTER),attention)p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d,d),p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2+(200-2*attention),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random()),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d,d),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2-(200-2*attention),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random());else{var testAttR=15*Math.random();p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d,d),p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2+(200-testAttR),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random()),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d,d),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d+meditationRange*Math.random(),d-meditationRange*Math.random()),p.ellipse(p5width/2-(200-testAttR),p5height/2+25,d-meditationRange*Math.random(),d+meditationRange*Math.random())}}})}}]),angular.module("visualisation").factory("Introvisualisation",[]),angular.module("visualisation").factory("waveVisualisation",["p5",function(){return function(p){try{var socket=io.connect("http://localhost:9876")}catch(e){var socket=io.connect()}p.colorMode(p.RGB,255);var socket=io.connect(),p5height=window.innerHeight,p5width=window.innerWidth,xpos=0,ypos=0;p.setup=function(){p.createCanvas(p5width,p5height),p.background(240,240,240)},socket.on("eeg",function(data){var waveCorrection=(data?data.blinkStrength:0,data?data.eSense.attention:0,data?data.eSense.meditation:0,100-data.poorSignalLevel/2,1e3),eegDelta=data?(data.eegPower.delta+1)/waveCorrection:0,cDelta=p.color(42,161,152),eegTheta=data?(data.eegPower.theta+1)/waveCorrection:0,cTheta=p.color(211,54,130),eegLowAlpha=data?(data.eegPower.lowAlpha+1)/waveCorrection:0,cLowAlpha=p.color(211,1,2),eegHighAlpha=data?(data.eegPower.highAlpha+1)/waveCorrection:0,cHighAlpha=p.color(203,75,22),eegLowBeta=data?(data.eegPower.lowBeta+1)/waveCorrection:0,cLowBeta=p.color(38,139,210),eegHighBeta=data?(data.eegPower.highBeta+1)/waveCorrection:0,cHighBeta=p.color(131,148,150),eegLowGamma=data?(data.eegPower.lowGamma+1)/waveCorrection:0,cLowGamma=p.color(133,153,0),eegHighGamma=data?(data.eegPower.highGamma+1)/waveCorrection:0,cHighGamma=p.color(88,110,117);p.draw=function(){p.stroke(cDelta),p.line(xpos,ypos,xpos,eegDelta),ypos+=eegDelta,p.stroke(cTheta),p.line(xpos,ypos,xpos,ypos+eegTheta),ypos+=eegTheta,p.stroke(cLowAlpha),p.line(xpos,ypos,xpos,ypos+eegLowAlpha),ypos+=eegLowAlpha,p.stroke(cHighAlpha),p.line(xpos,ypos,xpos,ypos+eegHighAlpha),ypos+=eegHighAlpha,p.stroke(cLowBeta),p.line(xpos,ypos,xpos,ypos+eegLowBeta),ypos+=eegLowBeta,p.stroke(cHighBeta),p.line(xpos,ypos,xpos,ypos+eegHighBeta),ypos+=eegHighBeta,p.stroke(cLowGamma),p.line(xpos,ypos,xpos,ypos+eegLowGamma),ypos+=eegLowGamma,p.stroke(cHighGamma),p.line(xpos,ypos,xpos,ypos+eegHighGamma),ypos+=eegHighGamma,xpos+=1,xpos>p5width&&(xpos=0),ypos=0}})}}]);